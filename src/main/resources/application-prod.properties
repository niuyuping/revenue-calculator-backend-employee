# Production environment configuration

# Production environment logging configuration - DEBUG MODE ENABLED (same as dev for consistency)
logging.level.root=DEBUG
logging.level.jp.asatex.revenue_calculator_backend_employee=DEBUG
logging.level.org.springframework.web.reactive=DEBUG
logging.level.org.springframework.r2dbc=DEBUG
logging.level.io.r2dbc.postgresql=DEBUG
logging.level.org.flywaydb=DEBUG
logging.level.org.springdoc=DEBUG
logging.level.io.r2dbc.pool=DEBUG
logging.level.io.r2dbc.spi=DEBUG
logging.level.org.springframework.boot=DEBUG
logging.level.org.springframework.context=DEBUG
logging.level.org.springframework.beans=DEBUG

# Production environment uses same console format as development for consistency
logging.pattern.console=%d{HH:mm:ss.SSS} [%thread] %highlight(%-5level) %cyan(%logger{36}) - %msg%n

# Cloud Run logging configuration - output to stdout/stderr
# 注释掉文件日志配置，因为Cloud Run无法访问容器内文件
# logging.file.name=/var/log/revenue-calculator/employee.log
# logging.logback.rollingpolicy.max-file-size=500MB
# logging.logback.rollingpolicy.max-history=60
# logging.logback.rollingpolicy.total-size-cap=10GB

spring.r2dbc.url=r2dbc:postgresql://localhost:5432/asatex-revenue
spring.r2dbc.username=db_user
spring.r2dbc.password=pkFsu,5,2u-$r6SO

# 显式启用R2DBC自动配置
spring.r2dbc.pool.enabled=true

spring.r2dbc.pool.max-size=${DB_POOL_MAX_SIZE:5}
spring.r2dbc.pool.max-idle-time=${DB_POOL_MAX_IDLE_TIME:PT5M}
spring.r2dbc.pool.max-life-time=${DB_POOL_MAX_LIFE_TIME:PT15M}
spring.r2dbc.pool.initial-size=1
spring.r2dbc.pool.validation-query=SELECT 1
spring.r2dbc.pool.max-acquire-time=PT30S
spring.r2dbc.pool.max-create-connection-time=PT30S

# Production environment Flyway configuration
spring.flyway.url=${DB_URL}
spring.flyway.user=${DB_USERNAME}

# 使用IAM身份验证，无需密码
spring.flyway.password=

# Production environment server configuration
server.port=${PORT:8080}

# Production environment Actuator configuration
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=never

# Google Cloud SQL Proxy configuration
# 连接名称: gen-lang-client-0889947961:asia-northeast1:asatex-revenue-calculator-database
# 数据库名称: asatex-revenue
# 用户名: db_user

# Redis configuration for production (if using Cloud Memorystore)
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.database=${REDIS_DATABASE:0}
spring.data.redis.timeout=${REDIS_TIMEOUT:2000ms}
spring.data.redis.lettuce.pool.max-active=${REDIS_POOL_MAX_ACTIVE:4}
spring.data.redis.lettuce.pool.max-idle=${REDIS_POOL_MAX_IDLE:4}
spring.data.redis.lettuce.pool.min-idle=${REDIS_POOL_MIN_IDLE:0}

# Cache configuration for production
spring.cache.type=redis
spring.cache.redis.time-to-live=${CACHE_TTL:1800000}
spring.cache.redis.cache-null-values=false

# Memory optimization settings - TEMPORARILY DISABLED FOR DEBUGGING
# spring.main.lazy-initialization=true
# spring.jpa.open-in-view=false  # 注释掉，可能影响R2DBC自动配置

# Debug configuration
debug=true
spring.output.ansi.enabled=always

# Swagger/OpenAPI configuration for production
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.try-it-out-enabled=false
springdoc.swagger-ui.operations-sorter=method
springdoc.swagger-ui.tags-sorter=alpha
springdoc.swagger-ui.display-request-duration=true
springdoc.swagger-ui.display-operation-id=false
springdoc.api-docs.enabled=true
springdoc.show-actuator=false
springdoc.swagger-ui.config-url=/v3/api-docs/swagger-config
springdoc.swagger-ui.disable-swagger-default-url=true
springdoc.swagger-ui.layout=StandaloneLayout
springdoc.swagger-ui.deep-linking=true
springdoc.swagger-ui.filter=true
springdoc.swagger-ui.show-extensions=false
springdoc.swagger-ui.show-common-extensions=false
springdoc.swagger-ui.supported-submit-methods=get,post,put,delete
springdoc.swagger-ui.validator-url=
# 默认只显示员工管理API，隐藏监控端点
springdoc.swagger-ui.default-models-expand-depth=1
springdoc.swagger-ui.default-model-expand-depth=1
springdoc.swagger-ui.doc-expansion=none

