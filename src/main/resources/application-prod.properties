# Production environment configuration


# Cloud SQL连接配置 - 基于Google官方文档优化
# 使用Unix Socket连接，参考: https://github.com/GoogleCloudPlatform/cloud-sql-jdbc-socket-factory
spring.r2dbc.url=${DB_URL}
spring.r2dbc.username=${DB_USER}
spring.r2dbc.password=${DB_PASSWORD}

# R2DBC连接池配置 - 生产环境优化
spring.r2dbc.pool.enabled=true
spring.r2dbc.pool.max-size=${DB_POOL_MAX_SIZE:10}
spring.r2dbc.pool.max-idle-time=${DB_POOL_MAX_IDLE_TIME:PT10M}
spring.r2dbc.pool.max-life-time=${DB_POOL_MAX_LIFE_TIME:PT30M}
spring.r2dbc.pool.initial-size=${DB_POOL_INITIAL_SIZE:2}
spring.r2dbc.pool.validation-query=SELECT 1
spring.r2dbc.pool.max-acquire-time=PT30S
spring.r2dbc.pool.max-create-connection-time=PT30S
spring.r2dbc.pool.max-validation-time=PT5S
spring.r2dbc.pool.validation-depth=remote

# Production environment Flyway configuration - 使用Cloud SQL Socket Factory
spring.flyway.enabled=true
spring.flyway.url=${FLYWAY_URL}
spring.flyway.user=${DB_USER}
spring.flyway.password=${DB_PASSWORD}
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=0
spring.flyway.validate-on-migrate=true
spring.flyway.clean-disabled=true
spring.flyway.out-of-order=false


# Production environment server configuration
server.port=${PORT:8080}

# Production environment Actuator configuration
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=never

# Google Cloud SQL Proxy configuration
# 连接名称: gen-lang-client-0889947961:asia-northeast1:asatex-revenue-calculator-database
# 数据库名称: asatex-revenue
# 用户名: db_user

# Redis configuration for production (if using Cloud Memorystore)
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.database=${REDIS_DATABASE:0}
spring.data.redis.timeout=${REDIS_TIMEOUT:2000ms}
spring.data.redis.lettuce.pool.max-active=${REDIS_POOL_MAX_ACTIVE:4}
spring.data.redis.lettuce.pool.max-idle=${REDIS_POOL_MAX_IDLE:4}
spring.data.redis.lettuce.pool.min-idle=${REDIS_POOL_MIN_IDLE:0}

# Cache configuration for production
spring.cache.type=redis
spring.cache.redis.time-to-live=${CACHE_TTL:1800000}
spring.cache.redis.cache-null-values=false

# Memory optimization settings
spring.main.lazy-initialization=true

# Production configuration
debug=false
spring.output.ansi.enabled=never

# Swagger/OpenAPI configuration for production
springdoc.swagger-ui.try-it-out-enabled=false
springdoc.swagger-ui.display-operation-id=false
springdoc.show-actuator=false
springdoc.swagger-ui.show-extensions=false
springdoc.swagger-ui.show-common-extensions=false
springdoc.swagger-ui.supported-submit-methods=get,post,put,delete
springdoc.swagger-ui.default-models-expand-depth=1
springdoc.swagger-ui.default-model-expand-depth=1
springdoc.swagger-ui.doc-expansion=none

